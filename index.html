<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { background: #000; color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; overflow: hidden; }
        
        /* –≠–∫—Ä–∞–Ω –∫–∞–ø—á–∏ 18+ */
        .screen { position: fixed; inset: 0; background: #000; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 1000; }
        .moon { width: 80px; height: 80px; background: #fff; border-radius: 50%; box-shadow: 0 0 40px #a020f0; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); box-shadow: 0 0 20px #a020f0; } 50% { transform: scale(1.1); box-shadow: 0 0 50px #a020f0; } }
        .btn-18 { background: linear-gradient(45deg, #a020f0, #6a0dad); color: white; border: none; padding: 15px 40px; border-radius: 25px; font-weight: bold; margin-top: 30px; cursor: pointer; box-shadow: 0 5px 15px rgba(160, 32, 240, 0.4); }

        /* –®–∞–ø–∫–∞ –∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ */
        .header { background: rgba(20, 20, 20, 0.8); backdrop-filter: blur(10px); padding: 20px; border-bottom: 2px solid #a020f0; display: flex; justify-content: space-between; align-items: center; }
        .user-info { display: flex; flex-direction: column; }
        .user-name { font-size: 18px; font-weight: bold; color: #fff; }
        .boss-glow { color: #ff3e3e; text-shadow: 0 0 15px #ff3e3e; }
        .balance { color: #f1c40f; font-size: 22px; font-weight: bold; }

        /* –°–µ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ */
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 20px; height: 60vh; overflow-y: auto; }
        .m-btn { background: #1a1a1a; border: 1px solid #333; border-radius: 15px; padding: 25px 10px; text-align: center; font-size: 14px; font-weight: 600; transition: 0.3s; position: relative; }
        .m-btn:active { background: #252525; transform: scale(0.95); border-color: #a020f0; }
        
        /* –ö–Ω–æ–ø–∫–∏ –û–≤–Ω–µ—Ä–∞ –∏ –ê–¥–º–∏–Ω–∞ */
        #own-btn { border: 2px solid #ff3e3e; color: #ff3e3e; display: none; grid-column: span 2; box-shadow: 0 0 10px rgba(255, 62, 62, 0.2); }
        #adm-btn { border: 2px solid #a020f0; color: #a020f0; display: none; grid-column: span 2; }
    </style>
</head>
<body>

    <div id="captcha" class="screen">
        <div class="moon"></div>
        <h1 style="margin-top:20px; letter-spacing: 2px;">LUNA 18+</h1>
        <button class="btn-18" onclick="startApp()">–ú–ù–ï –ï–°–¢–¨ 18 –õ–ï–¢</button>
    </div>

    <div id="app" style="display:none;">
        <div class="header">
            <div class="user-info">
                <span id="u-name" class="user-name">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                <span style="font-size: 12px; color: #888;">ID: <span id="u-id">----</span></span>
            </div>
            <div id="u-bal" class="balance">üåô 0</div>
        </div>

        <div class="menu-grid">
            <div class="m-btn">–ß–ê–¢–´</div>
            <div class="m-btn">–ü–ï–†–°–û–ù–ê–ñ–ò</div>
            <div class="m-btn">–ï–ñ–ï–î–ù–ï–í–ö–ê</div>
            <div class="m-btn">–ü–†–û–ú–û–ö–û–î–´</div>
            <div class="m-btn">–ú–ê–ì–ê–ó–ò–ù</div>
            <div class="m-btn">–ó–ê–î–ê–ù–ò–Ø</div>
            <div class="m-btn">–ü–†–û–§–ò–õ–¨</div>
            <div class="m-btn">–ù–ê–°–¢–†–û–ô–ö–ò</div>
            <div id="adm-btn" class="m-btn" onclick="alert('–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å')">–ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨</div>
            <div id="own-btn" class="m-btn" onclick="alert('–ö–æ–Ω—Å–æ–ª—å BOSS')">–ö–û–ù–°–û–õ–¨ BOSS</div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        // –¢–í–û–ô ID –î–õ–Ø –¢–ï–°–¢–ê –ò –ü–†–û–í–ï–†–ö–ò
        const MY_ID = 8287041036;
        const user = tg.initDataUnsafe.user || { id: MY_ID, first_name: "BOSS" };

        function startApp() {
            document.getElementById('captcha').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            loadData();
        }

        async function loadData() {
            try {
                const res = await fetch('/api/auth', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ tgId: user.id, name: user.first_name })
                });
                const data = await res.json();
                
                document.getElementById('u-id').innerText = user.id;
                const nameEl = document.getElementById('u-name');
                const balEl = document.getElementById('u-bal');

                // –ü–†–û–í–ï–†–ö–ê BOSS –°–¢–ê–¢–£–°–ê
                if (user.id === MY_ID || data.role === 'owner') {
                    nameEl.innerText = data.name + " [BOSS]";
                    nameEl.classList.add('boss-glow');
                    balEl.innerText = "üåô ‚àû";
                    document.getElementById('own-btn').style.display = 'block';
                    document.getElementById('adm-btn').style.display = 'block';
                } else {
                    nameEl.innerText = data.name;
                    balEl.innerText = "üåô " + (data.balance || 0);
                    if (data.role === 'admin') document.getElementById('adm-btn').style.display = 'block';
                }
            } catch (e) {
                document.getElementById('u-name').innerText = "–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞";
            }
        }
    </script>
</body>
</html>
