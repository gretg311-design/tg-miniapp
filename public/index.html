<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Anime AI Mini App</title>

  <!-- –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>

<body style="background:#000;color:#00ff88;font-family:monospace;padding:16px">

<h2 id="status">‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram...</h2>
<pre id="output"></pre>

<script>
const tg = window.Telegram.WebApp;
tg.ready();

// 1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram
fetch("/api/auth", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ initData: tg.initData })
})
.then(res => res.json())
.then(auth => {
  if (!auth.ok) {
    document.getElementById("status").textContent = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ Telegram";
    return;
  }

  // 2Ô∏è‚É£ –ü–æ–ª—É—á–µ–Ω–∏–µ / —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  return fetch("/api/me", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ user: auth.user })
  });
})
.then(res => res.json())
.then(me => {
  if (!me || !me.id) {
    document.getElementById("status").textContent = "‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω";
    return;
  }

  document.getElementById("status").textContent = "‚úÖ Mini App —Ä–∞–±–æ—Ç–∞–µ—Ç";

  document.getElementById("output").textContent =
`Telegram ID: ${me.id}
Username: @${me.username || "‚Äî"}

–ë–∞–ª–∞–Ω—Å: ${me.balance} üåô
–ü–æ–¥–ø–∏—Å–∫–∞: ${me.sub}

–ì–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω: ${me.isMainAdmin ? "–î–ê" : "–ù–ï–¢"}
`;
})
.catch(err => {
  document.getElementById("status").textContent = "‚ùå –û—à–∏–±–∫–∞";
  document.getElementById("output").textContent = err;
});
</script>

</body>
</html>
