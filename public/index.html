<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { background: #060a16; color: white; font-family: sans-serif; padding: 15px; margin: 0; }
        .header { display: flex; justify-content: space-between; color: #60a5fa; margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn { background: #151c30; border: 1px solid #232d4b; padding: 20px 5px; border-radius: 12px; text-align: center; font-weight: bold; font-size: 12px; }
        .full { grid-column: span 2; background: #3b82f6; border: none; padding: 15px; border-radius: 12px; color: white; margin-top: 10px; font-weight: bold; }
        .screen { display: none; }
        .active { display: block; }
        .card { background: #1e2944; padding: 10px; border-radius: 10px; margin-bottom: 10px; border-left: 4px solid #3b82f6; }
        input, textarea { width: 100%; margin: 5px 0; background: #0b1121; border: 1px solid #3b82f6; color: white; padding: 10px; box-sizing: border-box; border-radius: 8px; }
    </style>
</head>
<body>

    <div id="main-screen" class="screen active">
        <div class="header">
            <span id="userName">...</span>
            <span>üåô <span id="userBal">100</span></span>
        </div>
        <div class="grid">
            <div class="btn" onclick="tg.showAlert('–ß–∞—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç')">üí¨ –ß–ê–¢–´</div>
            <div class="btn" onclick="showScreen('chars-screen', loadChars)">üßç –ü–ï–†–°–û–ù–ê–ñ–ò</div>
            <div class="btn" onclick="tg.showAlert('–ë–æ–Ω—É—Å: +5 üåô')">üéÅ –ï–ñ–ï–î–ù–ï–í–ö–ê</div>
            <div class="btn" onclick="showScreen('tasks-screen', loadTasks)">üìã –ó–ê–î–ê–ù–ò–Ø</div>
            <div class="btn" onclick="tg.showAlert('–ú–∞–≥–∞–∑–∏–Ω –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')">üõí –ú–ê–ì–ê–ó–ò–ù</div>
            <div class="btn" onclick="tg.showAlert('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥')">üéü –ü–†–û–ú–û–ö–û–î–´</div>
            <div class="btn" onclick="tg.showAlert('–¢–≤–æ–π ID: ' + tg.initDataUnsafe.user.id)">üë§ –ü–†–û–§–ò–õ–¨</div>
            <div class="btn" onclick="tg.showAlert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ 18+')">‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò</div>
            <button class="full" onclick="window.open('https://t.me/your_channel')">üì¢ –ù–û–í–û–°–¢–ò</button>
            <button class="full" style="background:#ef4444; display:none;" id="godBtn" onclick="showScreen('admin-screen')">üíª –ö–û–ù–°–û–õ–¨ –ë–û–ì–ê</button>
        </div>
    </div>

    <div id="chars-screen" class="screen">
        <h3>–ü–µ—Ä—Å–æ–Ω–∞–∂–∏</h3>
        <div id="chars-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <button class="full" onclick="showScreen('main-screen')">–ù–∞–∑–∞–¥</button>
    </div>

    <div id="tasks-screen" class="screen">
        <h3>–ó–∞–¥–∞–Ω–∏—è</h3>
        <div id="tasks-list">–ó–∞–¥–∞–Ω–∏–π –Ω–µ—Ç</div>
        <button class="full" onclick="showScreen('main-screen')">–ù–∞–∑–∞–¥</button>
    </div>

    <div id="admin-screen" class="screen">
        <h3 style="color:#ef4444">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
        <p>–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞:</p>
        <input type="text" id="cName" placeholder="–ò–º—è">
        <textarea id="cBio" placeholder="–ò—Å—Ç–æ—Ä–∏—è (18+)"></textarea>
        <input type="file" id="cFile">
        <button class="full" style="background:#22c55e" onclick="saveChar()">–°–û–ó–î–ê–¢–¨ –ü–ï–†–°–û–ù–ê–ñ–ê</button>
        <hr>
        <p>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ:</p>
        <input type="text" id="tTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–ü–æ–¥–ø–∏—à–∏—Å—å)">
        <input type="text" id="tLink" placeholder="–°—Å—ã–ª–∫–∞ (https://t.me/...)">
        <button class="full" style="background:#3b82f6" onclick="saveTask()">–î–û–ë–ê–í–ò–¢–¨ –ó–ê–î–ê–ù–ò–ï</button>
        <button class="full" style="background:#444" onclick="showScreen('main-screen')">–ó–ê–ö–†–´–¢–¨</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        document.getElementById('userName').innerText = tg.initDataUnsafe.user?.first_name || "Owner";
        if(tg.initDataUnsafe.user?.id === 8287041036) document.getElementById('godBtn').style.display = 'block';

        function showScreen(id, callback) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(callback) callback();
        }

        async function saveChar() {
            const formData = new FormData();
            formData.append('name', document.getElementById('cName').value);
            formData.append('bio', document.getElementById('cBio').value);
            formData.append('photo', document.getElementById('cFile').files[0]);
            formData.append('userId', tg.initDataUnsafe.user.id);
            await fetch('/api/chars', { method: 'POST', body: formData });
            tg.showAlert("–ì–æ—Ç–æ–≤–æ!"); showScreen('main-screen');
        }

        async function saveTask() {
            await fetch('/api/tasks', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    action: 'add',
                    title: document.getElementById('tTitle').value,
                    link: document.getElementById('tLink').value,
                    userId: tg.initDataUnsafe.user.id
                })
            });
            tg.showAlert("–ó–∞–¥–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ!"); showScreen('main-screen');
        }

        async function loadChars() {
            const res = await fetch('/api/chars');
            const data = await res.json();
            document.getElementById('chars-list').innerHTML = data.map(c => `
                <div class="card">
                    <img src="${c.photo}" style="width:100%; border-radius:8px;">
                    <b>${c.name}</b><br><small>${c.bio}</small>
                </div>
            `).join('');
        }

        async function loadTasks() {
            const res = await fetch('/api/tasks');
            const data = await res.json();
            document.getElementById('tasks-list').innerHTML = data.map(t => `
                <div class="card" onclick="window.open('${t.link}')">
                    <b>${t.title}</b><br>–ù–∞–≥—Ä–∞–¥–∞: 10 üåô
                </div>
            `).join('');
        }
    </script>
</body>
</html>
