<pre id="debug"></pre>
<script>
document.getElementById("debug").innerText =
  "initData length: " + (window.Telegram?.WebApp?.initData?.length || 0);
</script>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<script>
const tg = window.Telegram.WebApp;
tg.ready();

if (!tg.initData) {
  document.body.innerHTML = "❌ Нет initData. Открой через Telegram.";
  throw new Error("NO_INIT_DATA");
}

fetch("/api/auth", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    initData: tg.initData   // ⬅️ ТОЛЬКО ЭТО
  })
})
.then(r => r.json())
.then(data => {
  if (!data.ok) {
    document.body.innerHTML = "❌ Ошибка проверки Telegram";
    return;
  }

  document.body.innerHTML = `
    <pre>
✅ Проверка пройдена

Telegram ID: ${data.user.id}
Username: @${data.user.username || "—"}
Premium: ${data.user.is_premium ? "YES" : "NO"}
    </pre>
  `;
})
.catch(err => {
  document.body.innerHTML = "❌ Серверная ошибка";
});
</script>
