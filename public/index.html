<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; font-family: sans-serif; }
        body { background: #060913; color: #fff; }
        .screen { display:none; padding:20px; }
        .active { display:block; }
        .card { background:#1e2a52; padding:15px; border-radius:12px; margin-bottom:10px; border: 1px solid #2a3569; }
        .btn { background:#4a90e2; padding:12px; border-radius:10px; text-align:center; cursor:pointer; font-weight:bold; margin-top:5px; }
        .owner-btn { background: #e74c3c; margin-top: 20px; }
        .admin-btn { background: #f1c40f; color: #000; }
        input { width: 100%; padding: 10px; margin: 5px 0; border-radius: 5px; border: none; }
        .top { padding:15px; background:#101633; display:flex; justify-content:space-between; }
    </style>
</head>
<body>

<div id="app">
    <div class="top">
        <div id="role-tag" style="font-size: 10px; color: #aaa;">User</div>
        <div>üåô <span id="bal">0</span></div>
    </div>

    <div id="home" class="screen active">
        <div id="user-info" style="margin-bottom: 20px;"></div>
        <div class="card" onclick="show('shop')">üõí –ú–∞–≥–∞–∑–∏–Ω</div>
        <div class="card" onclick="show('daily')">üéÅ –ë–æ–Ω—É—Å</div>
        <div id="admin-zone"></div> </div>

    <div id="console" class="screen">
        <h2>üëë –ö–æ–Ω—Å–æ–ª—å –û–≤–Ω–µ—Ä–∞</h2>
        <div class="card">
            <p>–í—ã–¥–∞—Ç—å –æ—Å–∫–æ–ª–∫–∏</p>
            <input type="number" id="give-id" placeholder="Telegram ID">
            <input type="number" id="give-amount" placeholder="–ö–æ–ª-–≤–æ">
            <div class="btn" onclick="adminAction('give')">–í—ã–¥–∞—Ç—å</div>
        </div>
        <div class="card">
            <p>–î–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∞</p>
            <input type="number" id="new-admin-id" placeholder="Telegram ID">
            <div class="btn admin-btn" onclick="addAdmin()">–ù–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–æ–º</div>
        </div>
        <div class="btn" onclick="loadLogs()">üìú –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏</div>
        <div id="logs-view" style="font-size: 10px; margin-top: 10px; max-height: 100px; overflow-y: auto;"></div>
        <div class="btn" onclick="show('home')">–ù–∞–∑–∞–¥</div>
    </div>

    <div id="shop" class="screen"><h2>–ú–∞–≥–∞–∑–∏–Ω</h2><div class="btn" onclick="show('home')">–ù–∞–∑–∞–¥</div></div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    const user = tg.initDataUnsafe.user || { id: 8287041036, first_name: "OwnerTest" }; // –î–ª—è —Ç–µ—Å—Ç–∞
    let myData = {};

    function loadUser() {
        fetch("/api/user", {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify({ id: user.id })
        })
        .then(r => r.json())
        .then(data => {
            myData = data;
            document.getElementById("bal").innerText = data.balance;
            document.getElementById("role-tag").innerText = data.role.toUpperCase();
            
            if (data.role === 'owner' || data.role === 'admin') {
                let html = `<div class="btn admin-btn" onclick="show('console')">üõ† –ö–æ–Ω—Å–æ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</div>`;
                if (data.role === 'owner') {
                    html += `<div class="btn owner-btn" onclick="alert('–õ–æ–≥–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—Ç–∞–Ω')">üëÄ –†–µ–∂–∏–º –û–≤–Ω–µ—Ä–∞</div>`;
                }
                document.getElementById("admin-zone").innerHTML = html;
            }
        });
    }

    function show(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function adminAction(type) {
        const targetId = document.getElementById('give-id').value;
        const amount = document.getElementById('give-amount').value;
        fetch("/api/admin/give", {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify({ adminId: user.id, targetId, amount })
        }).then(() => alert("–í—ã–ø–æ–ª–Ω–µ–Ω–æ!"));
    }

    function addAdmin() {
        const targetId = document.getElementById('new-admin-id').value;
        fetch("/api/owner/add-admin", {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify({ adminId: user.id, targetId })
        }).then(() => alert("–ê–¥–º–∏–Ω –¥–æ–±–∞–≤–ª–µ–Ω!"));
    }

    function loadLogs() {
        fetch("/api/owner/logs", {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify({ adminId: user.id })
        })
        .then(r => r.json())
        .then(logs => {
            const div = document.getElementById('logs-view');
            div.innerHTML = logs.map(l => `<div>${l.time}: ${l.admin_id} -> ${l.target_id} (${l.action})</div>`).join('');
        });
    }

    loadUser();
</script>
</body>
</html>
