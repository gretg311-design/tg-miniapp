<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Project A-Z</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap');
        body { background: #000; color: #fff; font-family: 'Inter', sans-serif; margin: 0; overflow: hidden; height: 100vh; }
        
        /* –õ–£–ù–ê –ó–ê–ì–†–£–ó–ö–ò */
        #splash { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: flex; justify-content: center; align-items: center; z-index: 100; transition: 0.5s; }
        .moon { width: 100px; height: 100px; background: radial-gradient(circle at 30% 30%, #fff, #8a2be2 70%); border-radius: 50%; box-shadow: 0 0 50px #8a2be2; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.1); opacity: 1; } }

        /* –ò–ù–¢–ï–†–§–ï–ô–° */
        #main-app { display: none; flex-direction: column; height: 100vh; }
        .header { display: flex; justify-content: space-between; padding: 25px 20px 10px; }
        .u-name { color: #b026ff; font-weight: 800; font-size: 19px; }
        .balance { display: flex; align-items: center; font-weight: 700; }
        .balance span { color: #ffa500; margin-right: 5px; }

        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 15px; flex-grow: 1; }
        .btn { background: rgba(40, 0, 70, 0.5); border: 1px solid rgba(138, 43, 226, 0.2); backdrop-filter: blur(10px); border-radius: 20px; display: flex; justify-content: center; align-items: center; text-transform: uppercase; font-size: 12px; font-weight: 700; cursor: pointer; height: 100px; }
        .console-btn { border: 1px solid #f00; color: #f00; }

        /* –û–ö–ù–ê */
        .window { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 50; padding: 20px; box-sizing: border-box; }
        .window.active { display: block; }
        .close { margin-top: 30px; color: #8a2be2; font-weight: 700; cursor: pointer; text-align: center; }
        
        input, select { width: 100%; padding: 12px; background: #1a0033; border: 1px solid #8a2be2; color: #fff; border-radius: 10px; margin: 10px 0; }
        .footer { display: flex; justify-content: space-around; padding: 20px; border-top: 1px solid #222; }
        .hidden { display: none !important; }
    </style>
</head>
<body onload="start()">

    <div id="splash"><div class="moon"></div></div>

    <div id="main-app">
        <div class="header">
            <div class="u-name" id="h-name">USER</div>
            <div class="balance"><span>üåô</span><div id="h-shards">0</div></div>
        </div>

        <div id="menu" class="menu-grid">
            <div class="btn" onclick="openW('chats')">–ß–ê–¢–´</div>
            <div class="btn" onclick="openW('chars')">–ü–ï–†–°–û–ù–ê–ñ–ò</div>
            <div class="btn" onclick="openW('daily')">–ï–ñ–ï–î–ù–ï–í–ö–ê</div>
            <div class="btn" onclick="openW('tasks')">–ó–ê–î–ê–ù–ò–Ø</div>
            <div class="btn" onclick="openW('shop')">–ú–ê–ì–ê–ó–ò–ù</div>
            <div class="btn" onclick="openW('promo')">–ü–†–û–ú–û–ö–û–î–´</div>
            <div class="btn" onclick="openW('profile')">–ü–†–û–§–ò–õ–¨</div>
            <div class="btn" onclick="openW('settings')">–ù–ê–°–¢–†–û–ô–ö–ò</div>
            <div class="btn" onclick="openW('admin')">–ê–î–ú–ò–ù–ö–ê</div>
            <div class="btn console-btn" id="c-btn" onclick="openW('console')">–ö–û–ù–°–û–õ–¨</div>
        </div>

        <div id="w-reg" class="window">
            <h2>–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø 18+</h2>
            <input type="text" id="r-name" placeholder="–¢–≤–æ–µ –∏–º—è">
            <select id="r-gender"><option value="male">–ú—É–∂—á–∏–Ω–∞</option><option value="female">–ñ–µ–Ω—â–∏–Ω–∞</option></select>
            <div class="btn" onclick="doReg()">–°–û–•–†–ê–ù–ò–¢–¨</div>
        </div>

        <div id="w-chats" class="window"><h2>–ß–ê–¢–´</h2><div class="close" onclick="closeW()">‚óÄ –ù–ê–ó–ê–î</div></div>
        <div id="w-console" class="window"><h2 style="color:red">–ö–û–ù–°–û–õ–¨ –û–í–ù–ï–†–ê</h2><div class="close" onclick="closeW()">‚óÄ –ù–ê–ó–ê–î</div></div>
        <div class="footer"><div onclick="closeW()">‚óÄ –ù–ê–ó–ê–î</div><div onclick="closeW()">üè† –î–û–ú–û–ô</div></div>
    </div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        const OWNER_ID = "8287041036";
        let myId = "0";

        async function start() {
            const tg = window.Telegram.WebApp;
            tg.expand();
            myId = tg.initDataUnsafe?.user?.id?.toString() || new URLSearchParams(window.location.search).get('tgId') || "0";

            const res = await fetch(`/api/get-user?tgId=${myId}`);
            const data = await res.json();

            setTimeout(() => {
                document.getElementById('splash').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('splash').classList.add('hidden');
                    document.getElementById('main-app').style.display = 'flex';
                    if (data.exists) {
                        document.getElementById('h-name').innerText = data.user.name.toUpperCase();
                        document.getElementById('h-shards').innerText = data.user.shards;
                        if (myId !== OWNER_ID) document.getElementById('c-btn').classList.add('hidden');
                    } else {
                        openW('reg');
                    }
                }, 500);
            }, 2000);
        }

        function openW(id) {
            document.querySelectorAll('.window').forEach(w => w.classList.remove('active'));
            document.getElementById('menu').classList.add('hidden');
            document.getElementById('w-' + id).classList.add('active');
        }

        function closeW() {
            document.querySelectorAll('.window').forEach(w => w.classList.remove('active'));
            document.getElementById('menu').classList.remove('hidden');
        }

        async function doReg() {
            const name = document.getElementById('r-name').value;
            const gender = document.getElementById('r-gender').value;
            await fetch('/api/register', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ tgId: myId, name, gender })
            });
            location.reload();
        }
    </script>
</body>
</html>
