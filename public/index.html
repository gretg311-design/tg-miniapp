<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --accent: #bc13fe; --glass: rgba(30, 0, 50, 0.85); }
        body { background: #000; color: #fff; font-family: sans-serif; margin: 0; overflow: hidden; touch-action: none; }
        
        /* –õ—É–Ω–∞ */
        #loader { position: fixed; inset: 0; background: #000; display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .moon { width: 80px; height: 80px; background: #fff; border-radius: 50%; box-shadow: 0 0 40px var(--accent); animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% {transform: scale(1);} 50% {transform: scale(1.15);} }

        /* UI */
        .reg { padding: 40px; text-align: center; display: flex; flex-direction: column; gap: 15px; height: 100vh; justify-content: center; }
        input, select, button { background: var(--glass); border: 1px solid var(--accent); color: #fff; padding: 15px; border-radius: 12px; font-size: 16px; }
        button { background: var(--accent); font-weight: bold; }
        
        .header { padding: 15px; border-bottom: 1px solid var(--accent); background: var(--glass); backdrop-filter: blur(10px); }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 15px; overflow-y: auto; height: 60vh; }
        .card { background: var(--glass); padding: 20px; border-radius: 15px; border: 1px solid rgba(188, 19, 254, 0.2); text-align: center; }

        /* VIP/Ultra –ü–∞–Ω–µ–ª—å */
        #vip-tools { margin: 10px; padding: 15px; border: 1px solid gold; border-radius: 15px; display: none; background: rgba(255, 215, 0, 0.05); }

        /* –ù–∏–∂–Ω–∏–π –±–∞—Ä */
        .nav-bar { position: fixed; bottom: 0; width: 100%; height: 75px; background: rgba(20, 0, 40, 0.95); border-top: 1px solid var(--accent); display: flex; justify-content: space-around; align-items: center; backdrop-filter: blur(15px); }
        .nav-btn { color: var(--accent); font-weight: bold; font-size: 13px; text-transform: uppercase; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div id="loader"><div class="moon"></div></div>

<div id="reg-screen" class="reg hidden">
    <h2 style="color: var(--accent)">ANIME AI 18+</h2>
    <input type="text" id="r-name" placeholder="–¢–≤–æ–µ –∏–º—è">
    <select id="r-gender"><option value="male">–ü–∞—Ä–µ–Ω—å</option><option value="female">–î–µ–≤—É—à–∫–∞</option></select>
    <p style="font-size: 12px;">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ, —á—Ç–æ –≤–∞–º –µ—Å—Ç—å 18 –ª–µ—Ç</p>
    <button onclick="initApp()">–ú–ù–ï –ï–°–¢–¨ 18 (–í–•–û–î)</button>
    <button style="background: #333;" onclick="window.Telegram.WebApp.close()">–í–´–ô–¢–ò</button>
</div>

<div id="app" class="hidden">
    <div class="header">
        <div style="display: flex; justify-content: space-between;">
            <b id="u-name">...</b>
            <span>üåô <b id="u-bal">0</b></span>
        </div>
        <div id="u-sub" style="font-size: 10px; color: gold; margin-top: 5px;">Ultra (–ü—Ä–æ–±–Ω–∏–∫)</div>
    </div>

    <div id="vip-tools">
        <div style="font-size: 11px; color: gold; margin-bottom: 5px;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ VIP/Ultra:</div>
        <input type="range" min="1" max="100" style="width:100%"> <small>–ü–æ—à–ª–æ—Å—Ç—å</small><br>
        <input type="range" id="w-slider" min="45" max="100" style="width:100%"> <small>–°–ª–æ–≤: <span id="w-val">45</span></small>
    </div>

    <div class="grid">
        <div class="card" onclick="spend('text')">üí¨ –ß–∞—Ç—ã (1üåô)</div>
        <div class="card" onclick="spend('photo')">üñºÔ∏è –§–æ—Ç–æ (5/2üåô)</div>
        <div class="card">üé≠ –ì–µ—Ä–æ–∏</div>
        <div class="card">üéÅ –ë–æ–Ω—É—Å</div>
        <div class="card">üõí –ú–∞–≥–∞–∑–∏–Ω</div>
        <div class="card" id="admin-btn" style="display:none">üõ°Ô∏è –ê–¥–º–∏–Ω</div>
    </div>

    <div class="nav-bar">
        <div class="nav-item nav-btn" onclick="alert('–ù–∞–∑–∞–¥')">‚óÄ –ù–ê–ó–ê–î</div>
        <div class="nav-item nav-btn" onclick="location.reload()">üè† –î–û–ú–û–ô</div>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    const API = "https://tg-miniapp-hr0a.onrender.com"; // –¢–≤–æ—è —Å—Å—ã–ª–∫–∞

    window.onload = () => {
        setTimeout(() => {
            document.getElementById('loader').classList.add('hidden');
            document.getElementById('reg-screen').classList.remove('hidden');
        }, 2000);
    };

    function initApp() {
        const name = document.getElementById('r-name').value;
        if(!name) return alert("–ò–º—è?");
        
        fetch(`${API}/api/init`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                id: tg.initDataUnsafe.user?.id || 123,
                name: name,
                gender: document.getElementById('r-gender').value,
                ref: tg.initDataUnsafe.start_param
            })
        }).then(r => r.json()).then(user => {
            document.getElementById('reg-screen').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            document.getElementById('u-name').innerText = user.name;
            document.getElementById('u-bal').innerText = user.balance;
            document.getElementById('u-sub').innerText = user.sub;

            // –ü–æ–ª–∑—É–Ω–∫–∏
            if(user.sub === 'VIP' || user.sub === 'Ultra') {
                document.getElementById('vip-tools').style.display = 'block';
                document.getElementById('w-slider').max = (user.sub === 'VIP' ? 80 : 100);
            }
            // –ê–¥–º–∏–Ω–∫–∞
            if(user.role === 'owner' || user.role === 'admin') document.getElementById('admin-btn').style.display='block';
        });
    }

    function spend(type) {
        fetch(`${API}/api/spend`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ id: tg.initDataUnsafe.user?.id || 123, type })
        }).then(r => r.json()).then(data => {
            if(data.success) document.getElementById('u-bal').innerText = data.balance;
            else alert(data.error);
        });
    }

    document.getElementById('w-slider').oninput = function() { document.getElementById('w-val').innerText = this.value; };
</script>
</body>
</html>
