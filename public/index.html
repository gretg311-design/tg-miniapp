<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@700;800&display=swap');
        body, html { background: #000; margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; color: #fff; font-family: 'Inter', sans-serif; }
        
        /* –õ–£–ù–ê –°–†–ê–ó–£ */
        #splash { position: fixed; inset: 0; background: #000; display: flex; justify-content: center; align-items: center; z-index: 9999; }
        .moon { width: 90px; height: 90px; background: radial-gradient(circle at 30% 30%, #fff, #8a2be2 75%); border-radius: 50%; box-shadow: 0 0 50px #8a2be2; animation: p 2s infinite ease-in-out; }
        @keyframes p { 0%, 100% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.1); opacity: 1; } }

        #app { display: none; flex-direction: column; height: 100vh; }
        .header { display: flex; justify-content: space-between; padding: 40px 20px 10px; }
        .u-name { color: #b026ff; font-weight: 800; font-size: 19px; }
        .balance { color: #ffa500; font-weight: 700; font-size: 18px; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: repeat(5, 1fr); gap: 12px; padding: 15px; flex-grow: 1; }
        .btn { background: rgba(30, 5, 50, 0.6); border: 1px solid rgba(138, 43, 226, 0.3); backdrop-filter: blur(15px); border-radius: 20px; display: flex; justify-content: center; align-items: center; font-size: 12px; font-weight: 700; text-transform: uppercase; cursor: pointer; height: 100%; }
        .console { border: 1px solid #f33; color: #f33; }

        .window { display: none; position: fixed; inset: 0; background: #000; z-index: 1000; padding: 20px; }
        .active { display: block; }
        .footer { display: flex; justify-content: space-around; padding: 20px; border-top: 1px solid #222; }
    </style>
</head>
<body onload="init()">
    <div id="splash"><div class="moon"></div></div>
    <div id="app">
        <div class="header">
            <div class="u-name" id="un">...</div>
            <div class="balance">üåô <span id="sh">0</span></div>
        </div>
        <div class="grid">
            <div class="btn" onclick="openW('chats')">–ß–ê–¢–´</div>
            <div class="btn" onclick="openW('chars')">–ü–ï–†–°–û–ù–ê–ñ–ò</div>
            <div class="btn" onclick="openW('daily')">–ï–ñ–ï–î–ù–ï–í–ö–ê</div>
            <div class="btn" onclick="openW('tasks')">–ó–ê–î–ê–ù–ò–Ø</div>
            <div class="btn" onclick="openW('shop')">–ú–ê–ì–ê–ó–ò–ù</div>
            <div class="btn" onclick="openW('promo')">–ü–†–û–ú–û–ö–û–î–´</div>
            <div class="btn" onclick="openW('profile')">–ü–†–û–§–ò–õ–¨</div>
            <div class="btn" onclick="openW('settings')">–ù–ê–°–¢–†–û–ô–ö–ò</div>
            <div class="btn" id="adm" onclick="openW('admin')">–ê–î–ú–ò–ù–ö–ê</div>
            <div class="btn console" id="con" onclick="openW('console')">–ö–û–ù–°–û–õ–¨</div>
        </div>
        <div class="footer"><div onclick="closeW()">‚óÄ –ù–ê–ó–ê–î</div><div onclick="closeW()">üè† –î–û–ú–û–ô</div></div>
    </div>

    <div id="w-reg" class="window">
        <h2>–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø</h2>
        <input type="text" id="rn" placeholder="–ò–º—è" style="width:100%; padding:15px; margin-bottom:10px; background:#1a0033; border:1px solid #8a2be2; color:#fff; border-radius:10px;">
        <select id="rg" style="width:100%; padding:15px; background:#1a0033; border:1px solid #8a2be2; color:#fff; border-radius:10px;">
            <option value="male">–ú—É–∂—á–∏–Ω–∞</option><option value="female">–ñ–µ–Ω—â–∏–Ω–∞</option>
        </select>
        <div class="btn" style="height:60px; margin-top:20px" onclick="reg()">–ù–ê–ß–ê–¢–¨</div>
    </div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        const OWNER_ID = "8287041036";
        let myId = "";
        const tg = window.Telegram.WebApp;

        async function init() {
            tg.ready(); tg.expand();
            myId = tg.initDataUnsafe?.user?.id?.toString() || new URLSearchParams(window.location.search).get('tgId') || OWNER_ID;
            
            try {
                const res = await fetch(`/api/get-user?tgId=${myId}`);
                const data = await res.json();
                setTimeout(() => {
                    document.getElementById('splash').style.display = 'none';
                    document.getElementById('app').style.display = 'flex';
                    if (data.exists) {
                        document.getElementById('un').innerText = data.user.name;
                        document.getElementById('sh').innerText = data.user.shards;
                        if (myId !== OWNER_ID) document.getElementById('con').style.display = 'none';
                    } else { document.getElementById('w-reg').classList.add('active'); }
                }, 1500);
            } catch (e) { document.getElementById('splash').style.display = 'none'; document.getElementById('app').style.display = 'flex'; }
        }

        function openW(id) { document.querySelectorAll('.window').forEach(w => w.classList.remove('active')); document.getElementById('w-'+id)?.classList.add('active'); }
        function closeW() { document.querySelectorAll('.window').forEach(w => w.classList.remove('active')); }
        async function reg() {
            const name = document.getElementById('rn').value;
            const gender = document.getElementById('rg').value;
            await fetch('/api/register', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ tgId: myId, name, gender }) });
            location.reload();
        }
    </script>
</body>
</html>
