<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: #0f172a; color: white; padding: 15px; }
        .screen { display: none; }
        .active { display: block; }
        .card { background: #1e293b; border-radius: 20px; padding: 20px; margin-bottom: 15px; }
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .btn { background: #3b82f6; padding: 15px; border-radius: 12px; text-align: center; font-weight: bold; margin-top: 10px; border:none; color:white; width:100%; }
        input, select { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: none; background: #0f172a; color: white; }
        .label { font-size: 12px; opacity: 0.7; }
        .admin-only { display: none; border: 2px solid #f59e0b; padding: 10px; border-radius: 15px; }
    </style>
</head>
<body>

<div id="home" class="screen active">
    <h2>AnimeAI 18+</h2>
    <div class="menu-grid">
        <div class="card" onclick="show('chats')">üí¨ –ß–∞—Ç—ã</div>
        <div class="card" onclick="show('chars')">üßç –ü–µ—Ä—Å–æ–Ω–∞–∂–∏</div>
        <div class="card" onclick="show('promo')">üéü –ü—Ä–æ–º–æ–∫–æ–¥</div>
        <div class="card" onclick="show('settings')">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
    </div>
    <div id="owner-btn" class="admin-only" onclick="show('console')" style="margin-top:20px; text-align:center; background:#ef4444">üëë –ö–û–ù–°–û–õ–¨ –û–í–ù–ï–†–ê</div>
</div>

<div id="settings" class="screen">
    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
    <div class="card">
        <p class="label">–Ø–∑—ã–∫ / Language</p>
        <select id="set-lang">
            <option value="ru">–†—É—Å—Å–∫–∏–π</option>
            <option value="ua">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
            <option value="en">English</option>
        </select>

        <p class="label">–†–µ–≤–Ω–æ—Å—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π (0-100%)</p>
        <input type="range" id="set-jealousy" min="0" max="100">

        <p class="label">–ü–æ—à–ª–æ—Å—Ç—å (–¢–æ–ª—å–∫–æ –¥–ª—è VIP/Ultra)</p>
        <input type="range" id="set-purity" min="0" max="100">

        <p class="label">–î–ª–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–π (–°–ª–æ–≤)</p>
        <input type="number" id="set-len" readonly>
        <p style="font-size:10px" id="len-info"></p>
    </div>
    <button class="btn" onclick="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <button class="btn" style="background:gray" onclick="show('home')">–ù–∞–∑–∞–¥</button>
</div>

<div id="promo" class="screen">
    <h3>–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞</h3>
    <input type="text" id="promo-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥">
    <button class="btn" onclick="usePromo()">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
    <button class="btn" style="background:gray" onclick="show('home')">–ù–∞–∑–∞–¥</button>
</div>

<script>
    const tg = window.Telegram.WebApp;
    const user = tg.initDataUnsafe.user || { id: 8287041036, first_name: "Owner" };
    let myData = {};

    function load() {
        fetch("/api/user", {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify({ id: user.id })
        }).then(r => r.json()).then(data => {
            myData = data;
            if (data.role === 'owner') document.getElementById('owner-btn').style.display = 'block';
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –¥–ª–∏–Ω—ã —Å–æ–æ
            let min = 45, max = 45;
            if(data.sub_type === 'Free') { max = 45; }
            else if(['Premium', 'Pro'].includes(data.sub_type)) { max = 65; }
            else if(['VIP', 'Ultra'].includes(data.sub_type)) { max = 100; }
            
            document.getElementById('set-len').value = max;
            document.getElementById('len-info').innerText = `–í–∞—à –ª–∏–º–∏—Ç: ${min}-${max} —Å–ª–æ–≤`;
            
            // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª–µ–π –Ω–∞—Å—Ç—Ä–æ–µ–∫
            document.getElementById('set-lang').value = data.lang || 'ru';
            document.getElementById('set-jealousy').value = data.jealousy || 50;
        });
    }

    function saveSettings() {
        const body = {
            id: user.id,
            lang: document.getElementById('set-lang').value,
            jealousy: document.getElementById('set-jealousy').value,
            purity: document.getElementById('set-purity').value,
            msg_length: document.getElementById('set-len').value
        };
        fetch("/api/settings", {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify(body)
        }).then(() => { alert("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!"); show('home'); });
    }

    function show(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    load();
</script>
</body>
</html>
