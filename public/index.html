<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Anime AI 18+</title>

  <!-- –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>

<body style="background:black;color:#00ff88;font-family:monospace">

<h3>üîê –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...</h3>

<script>
if (!window.Telegram || !Telegram.WebApp || !Telegram.WebApp.initData) {
  document.body.innerHTML += "<pre>‚ùå –ù–µ—Ç initData. –û—Ç–∫—Ä–æ–π –º–∏–Ω–∏-–∞–ø–ø –∏–∑ Telegram.</pre>";
  throw new Error("NO_INIT_DATA");
}

const tg = Telegram.WebApp;
tg.ready();

fetch("/api/auth", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ initData: tg.initData })
})
.then(async r => {
  const text = await r.text();
  try {
    return JSON.parse(text);
  } catch {
    throw new Error("SERVER RETURNED NOT JSON:\n" + text);
  }
})
.then(data => {
  if (!data.ok) {
    document.body.innerHTML += "<pre>‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏</pre>";
    return;
  }

  document.body.innerHTML = `
<pre>
‚úÖ –î–û–°–¢–£–ü –†–ê–ó–†–ï–®–Å–ù

ID: ${data.user.id}
Username: @${data.user.username || "‚Äî"}
Premium: ${data.user.is_premium ? "YES" : "NO"}
</pre>`;
})
.catch(e => {
  document.body.innerHTML += "<pre>‚ùå " + e.message + "</pre>";
});
</script>

</body>
</html>
