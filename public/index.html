<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Anime RP AI</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      background: #0b0b0f;
      color: #eaeaff;
      font-family: system-ui, sans-serif;
      padding: 20px;
    }
    .box {
      border: 1px solid #6b5cff;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
    }
    .btn {
      background: #6b5cff;
      color: white;
      padding: 12px;
      border-radius: 10px;
      text-align: center;
      margin-top: 10px;
    }
  </style>
</head>

<body>

<h2>ğŸŒ™ Anime RP AI</h2>
<div id="status" class="box">ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Telegramâ€¦</div>

<script>
const tg = window.Telegram.WebApp;
tg.ready();

if (!tg.initData || tg.initData.length < 10) {
  document.getElementById("status").innerText =
    "âŒ ĞÑ‚ĞºÑ€Ğ¾Ğ¹ Ğ¼Ğ¸Ğ½Ğ¸-Ğ°Ğ¿Ğ¿ Ğ˜Ğ— Telegram";
  throw new Error("NO INIT DATA");
}

fetch("/api/auth", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ initData: tg.initData })
})
.then(r => r.json())
.then(data => {
  if (!data.ok) {
    document.getElementById("status").innerText =
      "âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Telegram Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸";
    return;
  }

  document.body.innerHTML = `
    <h2>ğŸŒ™ Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ</h2>

    <div class="box">
      ğŸ‘¤ <b>${data.user.username || "Ğ‘ĞµĞ· username"}</b><br>
      ğŸ†” ${data.user.telegram_id}<br>
      â­ ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ°: ${data.user.subscription}<br>
      ğŸ’ ĞÑĞºĞ¾Ğ»ĞºĞ¸: ${data.user.moon_shards}<br>
      ğŸ›¡ï¸ Ğ Ğ¾Ğ»ÑŒ: ${data.user.role}
    </div>

    <div class="box btn">ğŸ§‘â€ğŸ­ ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ¸</div>
    <div class="box btn">ğŸ’¬ Ğ§Ğ°Ñ‚Ñ‹</div>
    <div class="box btn">ğŸ’ ĞœĞ°Ğ³Ğ°Ğ·Ğ¸Ğ½</div>

    ${data.user.role === "owner" ? `
      <div class="box btn">ğŸ›  ĞĞ´Ğ¼Ğ¸Ğ½-ĞºĞ¾Ğ½ÑĞ¾Ğ»ÑŒ</div>
    ` : ""}
  `;
})
.catch(err => {
  document.getElementById("status").innerText =
    "âŒ Ğ¡ĞµÑ€Ğ²ĞµÑ€Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°";
  console.error(err);
});
</script>

</body>
</html>
