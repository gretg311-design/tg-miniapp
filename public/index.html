<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Anime AI 18+</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --purple: #a020f0; --border: #301934; --dark: #000; --card-bg: #0a0510; }
        
        body { 
            background: var(--dark); 
            color: white; 
            font-family: 'Segoe UI', sans-serif; 
            margin: 0; 
            padding: 15px; 
            display: flex; 
            flex-direction: column; 
            align-items: center;
        }

        /* –ö–ê–†–¢–û–ß–ö–ê –ü–†–û–§–ò–õ–Ø (–ö–ê–ö –ù–ê –°–ö–†–ò–ù–ï) */
        .profile-card {
            width: 100%;
            border: 1px solid var(--purple);
            border-radius: 25px;
            padding: 20px;
            background: var(--card-bg);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-sizing: border-box;
            margin-bottom: 25px;
        }

        .user-info .name {
            font-style: italic;
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 4px;
        }

        .user-info .id {
            color: #888;
            font-size: 13px;
        }

        .balance-box {
            color: var(--purple);
            font-weight: bold;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* –°–ï–¢–ö–ê 10 –ö–ù–û–ü–û–ö */
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            width: 100%;
        }

        .btn {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 30px 10px;
            text-align: center;
            text-transform: uppercase;
            font-weight: bold;
            font-size: 12px;
            letter-spacing: 1px;
            cursor: pointer;
            transition: 0.3s;
        }

        .btn:active {
            border-color: var(--purple);
            background: #150a20;
        }

        /* –ö–ù–û–ü–ö–ò –î–õ–Ø BOSS */
        .btn.admin-btn { border-color: var(--border); color: white; }
        .btn.console-btn { border-color: #ff0000; color: #ff0000; }

        /* –≠–ö–†–ê–ù–´ */
        .screen { display: none; width: 100%; flex-direction: column; }
        .screen.active { display: flex; }

        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø –í–ù–ò–ó–£ */
        .nav-bar {
            position: fixed;
            bottom: 25px;
            width: calc(100% - 30px);
            display: flex;
            justify-content: space-between;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        .nav-item {
            color: white;
            text-transform: uppercase;
            font-weight: bold;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }

        input, select {
            width: 100%;
            background: #111;
            border: 1px solid var(--purple);
            color: white;
            padding: 15px;
            border-radius: 12px;
            margin: 10px 0;
            box-sizing: border-box;
        }

        .save-btn {
            background: var(--purple);
            border: none;
            color: white;
            padding: 18px;
            border-radius: 15px;
            font-weight: bold;
            text-transform: uppercase;
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <div id="main-screen" class="screen active">
        <div class="profile-card">
            <div class="user-info">
                <div id="u-name" class="name">–ó–ê–ì–†–£–ó–ö–ê...</div>
                <div id="u-id" class="id">ID: --------</div>
            </div>
            <div class="balance-box">
                üåô <span id="u-bal">0</span>
            </div>
        </div>

        <div class="grid">
            <div class="btn" onclick="openSection('–ß–∞—Ç—ã')">–ß–∞—Ç—ã</div>
            <div class="btn" onclick="openSection('–ü–µ—Ä—Å–æ–Ω–∞–∂–∏')">–ü–µ—Ä—Å–æ–Ω–∞–∂–∏</div>
            <div class="btn" onclick="openSection('–ï–∂–µ–¥–Ω–µ–≤–∫–∞')">–ï–∂–µ–¥–Ω–µ–≤–∫–∞</div>
            <div class="btn" onclick="openSection('–ó–∞–¥–∞–Ω–∏—è')">–ó–∞–¥–∞–Ω–∏—è</div>
            <div class="btn" onclick="openSection('–ú–∞–≥–∞–∑–∏–Ω')">–ú–∞–≥–∞–∑–∏–Ω</div>
            <div class="btn" onclick="openSection('–ü—Ä–æ–º–æ–∫–æ–¥—ã')">–ü—Ä–æ–º–æ–∫–æ–¥—ã</div>
            <div class="btn" onclick="openSection('–ü—Ä–æ—Ñ–∏–ª—å')">–ü—Ä–æ—Ñ–∏–ª—å</div>
            <div class="btn" onclick="openSettings()">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
            <div class="btn admin-btn" id="adm-btn" style="display:none;" onclick="openSection('–ê–¥–º–∏–Ω–∫–∞')">–ê–¥–º–∏–Ω–∫–∞</div>
            <div class="btn console-btn" id="con-btn" style="display:none;" onclick="openSection('–ö–æ–Ω—Å–æ–ª—å')">–ö–æ–Ω—Å–æ–ª—å</div>
        </div>
    </div>

    <div id="settings-screen" class="screen">
        <h2 style="color: var(--purple); text-transform: uppercase;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
        <label>–ò–ú–Ø:</label>
        <input type="text" id="set-name">
        <label>–ü–û–õ:</label>
        <select id="set-gender">
            <option value="–ú—É–∂—Å–∫–æ–π">–ú–£–ñ–°–ö–û–ô</option>
            <option value="–ñ–µ–Ω—Å–∫–∏–π">–ñ–ï–ù–°–ö–ò–ô</option>
        </select>
        <label>–î–õ–ò–ù–ê –û–¢–í–ï–¢–û–í:</label>
        <input type="range" id="set-len" min="1" max="100">
        <button class="save-btn" onclick="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>

    <div id="other-screen" class="screen">
        <h2 id="screen-title" style="color: var(--purple); text-transform: uppercase;"></h2>
        <div style="background: var(--card-bg); border: 1px solid var(--border); padding: 20px; border-radius: 20px;">
            –†–∞–∑–¥–µ–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...
        </div>
    </div>

    <div class="nav-bar">
        <div class="nav-item" onclick="goHome()">üè† –î–û–ú–û–ô</div>
        <div class="nav-item" onclick="goHome()">‚óÄ –ù–ê–ó–ê–î</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–π ID –¥–ª—è BOSS-–ø—Ä–∞–≤
        const tgUser = tg.initDataUnsafe?.user || { id: 8287041036, first_name: "BOSS" };
        let user = null;

        function init() {
            fetch('/api/auth', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ tgId: tgUser.id })
            })
            .then(res => res.json())
            .then(data => {
                if (data.isNew) {
                    registerUser();
                } else {
                    user = data;
                    render();
                }
            });
        }

        function registerUser() {
            fetch('/api/register', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ tgId: tgUser.id, name: tgUser.first_name, gender: '–ú—É–∂—Å–∫–æ–π' })
            })
            .then(res => res.json())
            .then(data => { user = data; render(); });
        }

        function render() {
            document.getElementById('u-name').innerHTML = `${user.name} ${user.role === 'owner' ? '<span style="color:white; font-style:normal;">(BOSS)</span>' : ''}`;
            document.getElementById('u-id').innerText = `ID: ${user.tgId}`;
            document.getElementById('u-bal').innerText = user.balance;

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ BOSS
            if (user.role === 'owner' || user.role === 'admin') document.getElementById('adm-btn').style.display = 'block';
            if (user.role === 'owner') document.getElementById('con-btn').style.display = 'block';
        }

        function openSettings() {
            hideAll();
            document.getElementById('settings-screen').classList.add('active');
            document.getElementById('set-name').value = user.name;
        }

        function openSection(title) {
            hideAll();
            const s = document.getElementById('other-screen');
            document.getElementById('screen-title').innerText = title;
            s.classList.add('active');
        }

        function saveSettings() {
            const name = document.getElementById('set-name').value;
            const gender = document.getElementById('set-gender').value;
            const len = document.getElementById('set-len').value;

            fetch('/api/update-settings', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ tgId: user.tgId, name, gender, lengthOffset: len })
            }).then(() => location.reload());
        }

        function hideAll() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        }

        function goHome() {
            hideAll();
            document.getElementById('main-screen').classList.add('active');
        }

        init();
    </script>
</body>
</html>
