<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>AnimeAI 18+</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    font-family: sans-serif;
    background: radial-gradient(circle at top, #1b2340, #060913 75%);
    color: #fff;
    min-height: 100vh;
  }
  #loader {
    position:fixed; inset:0; background:#050814;
    display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:999;
  }
  .moon {
    width:80px; height:80px; border-radius:50%; background:#eee;
    box-shadow:0 0 40px rgba(255,255,255,0.4); animation: pulse 2s infinite;
  }
  @keyframes pulse { 0%{transform:scale(1)} 50%{transform:scale(1.1)} 100%{transform:scale(1)} }
  
  .top { padding:15px; background:#101633; display:flex; justify-content:space-between; align-items:center; }
  .balance { color:#ffcc00; font-weight:bold; background:#1e2a52; padding:5px 10px; border-radius:10px; }
  
  .screen { display:none; padding:15px; }
  .active { display:block; }
  
  .menu { display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px; }
  .card { background:#1e2a52; padding:20px; border-radius:15px; text-align:center; border:1px solid #2a3569; }
  .back { margin-top:20px; text-align:center; opacity:0.6; }
  .btn { background:#4a90e2; padding:15px; border-radius:10px; text-align:center; margin-top:10px; font-weight:bold; }
</style>
</head>
<body>

<div id="loader">
  <div class="moon"></div>
  <p style="margin-top:15px">–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞–≥–∏–∏...</p>
</div>

<div id="app" style="display:none">
  <div class="top">
    <div>
      <div id="uname" style="font-weight:bold">–ò–≥—Ä–æ–∫</div>
      <div id="uid" style="font-size:10px; opacity:0.5">ID</div>
    </div>
    <div class="balance">üåô <span id="bal">0</span></div>
  </div>

  <div id="home" class="screen active">
    <div class="menu">
      <div class="card" onclick="show('chats')">üí¨ –ß–∞—Ç—ã</div>
      <div class="card" onclick="show('shop')">üõí –ú–∞–≥–∞–∑–∏–Ω</div>
      <div class="card" onclick="show('daily')">üéÅ –ë–æ–Ω—É—Å</div>
      <div class="card" onclick="show('profile')">üë§ –ü—Ä–æ—Ñ–∏–ª—å</div>
    </div>
  </div>

  <div id="shop" class="screen">
    <h2>–ú–∞–≥–∞–∑–∏–Ω</h2>
    <div class="btn" onclick="buy(100)">–ö—É–ø–∏—Ç—å 100 üåô (–¢–µ—Å—Ç)</div>
    <div class="btn" onclick="buy(500)">–ö—É–ø–∏—Ç—å 500 üåô (–¢–µ—Å—Ç)</div>
    <div class="back" onclick="show('home')">‚Üê –ù–∞–∑–∞–¥</div>
  </div>

  <div id="daily" class="screen">
    <h2>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å</h2>
    <div class="btn" style="background:#27ae60" onclick="collectDaily()">–ó–∞–±—Ä–∞—Ç—å 50 üåô</div>
    <div class="back" onclick="show('home')">‚Üê –ù–∞–∑–∞–¥</div>
  </div>

  <div id="chats" class="screen"><h2>–ß–∞—Ç—ã</h2><p>–ü–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤.</p><div class="back" onclick="show('home')">‚Üê –ù–∞–∑–∞–¥</div></div>
  <div id="profile" class="screen"><h2>–ü—Ä–æ—Ñ–∏–ª—å</h2><p>–¢—É—Ç –±—É–¥–µ—Ç –≤–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞.</p><div class="back" onclick="show('home')">‚Üê –ù–∞–∑–∞–¥</div></div>
</div>

<script>
  const tg = window.Telegram.WebApp;
  tg.ready();
  const user = tg.initDataUnsafe.user || {id: 0, first_name: "User"};

  document.getElementById("uname").innerText = user.first_name;
  document.getElementById("uid").innerText = "ID: " + user.id;

  // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
  fetch("/api/user", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({id: user.id})
  })
  .then(r => r.json())
  .then(data => {
    document.getElementById("bal").innerText = data.balance;
    document.getElementById("loader").style.display = "none";
    document.getElementById("app").style.display = "block";
  });

  function show(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  function buy(amt) {
    fetch("/api/buy", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({id: user.id, amount: amt})
    })
    .then(r => r.json())
    .then(data => {
      document.getElementById("bal").innerText = data.balance;
      alert("–î–æ–±–∞–≤–ª–µ–Ω–æ " + amt + " –æ—Å–∫–æ–ª–∫–æ–≤!");
    });
  }

  function collectDaily() {
    fetch("/api/daily", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({id: user.id})
    })
    .then(r => r.json())
    .then(data => {
      if(data.success) {
        alert("–í—ã –ø–æ–ª—É—á–∏–ª–∏ 50 üåô!");
        location.reload();
      } else {
        alert(data.message);
      }
    });
  }
</script>
</body>
</html>
