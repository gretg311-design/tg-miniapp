<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body { background: #05000a; color: #fff; font-family: sans-serif; margin: 0; padding: 15px; }
        
        /* –ó–∞–≥—Ä—É–∑–æ—á–Ω–∞—è –õ—É–Ω–∞ */
        #loading { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #05000a; display: flex; align-items: center; justify-content: center; z-index: 999; }
        .moon { width: 60px; height: 60px; background: #fff; border-radius: 50%; box-shadow: 0 0 20px #fff; animation: p 1.5s infinite; }
        @keyframes p { 0%, 100% { opacity: 0.5; transform: scale(0.9); } 50% { opacity: 1; transform: scale(1); } }

        .header { display: flex; justify-content: space-between; margin-bottom: 20px; border-bottom: 1px solid #222; padding-bottom: 10px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn { background: #1a0033; border: 1px solid #444; padding: 20px; border-radius: 10px; text-align: center; font-size: 12px; font-weight: bold; }
        
        /* –ö–Ω–æ–ø–∫–∏ –æ–≤–Ω–µ—Ä–∞ */
        #own-controls { display: none; margin-top: 20px; border-top: 1px solid red; padding-top: 10px; }
        .admin-btn { background: #300; border: 1px solid red; color: red; margin-top: 5px; width: 100%; padding: 15px; border-radius: 10px; font-weight: bold; }

        /* –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å */
        .nav { position: fixed; bottom: 0; left: 0; width: 100%; display: flex; height: 60px; background: #111; border-top: 1px solid #333; }
        .nav-btn { flex: 1; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; color: #888; }
    </style>
</head>
<body>

<div id="loading"><div class="moon"></div></div>

<div class="header">
    <div>
        <b id="name-display">...</b><br>
        <small id="id-display" style="color:gray"></small>
    </div>
    <div style="text-align:right">
        üåô <b id="shard-display">0</b>
    </div>
</div>

<div class="grid">
    <div class="btn">–ß–ê–¢–´</div><div class="btn">–ü–ï–†–°–û–ù–ê–ñ–ò</div>
    <div class="btn">–ú–ê–ì–ê–ó–ò–ù</div><div class="btn">–ó–ê–î–ê–ù–ò–Ø</div>
</div>

<div id="own-controls">
    <button class="admin-btn" onclick="addShards()">–î–û–ë–ê–í–ò–¢–¨ –û–°–ö–û–õ–ö–ò (ID)</button>
</div>

<div class="nav">
    <div class="nav-btn" style="border-right:1px solid #222">–ù–ê–ó–ê–î</div>
    <div class="nav-btn">–î–û–ú–û–ô</div>
</div>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
    const tg = window.Telegram.WebApp;
    const myId = tg.initDataUnsafe?.user?.id || 8287041036; 
    const myName = tg.initDataUnsafe?.user?.first_name || "User";

    async function init() {
        try {
            const res = await fetch('/api/auth', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ tg_id: myId, name: myName })
            });
            const data = await res.json();

            // –ï—Å–ª–∏ –ø—Ä–∏—à–µ–ª –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç, –∑–∞–ø–æ–ª–Ω—è–µ–º —ç–∫—Ä–∞–Ω
            document.getElementById('name-display').innerText = data.user_name || myName;
            document.getElementById('id-display').innerText = "ID: " + (data.id || myId);
            document.getElementById('shard-display').innerText = (data.shards !== undefined) ? data.shards : 0;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –æ–≤–Ω–µ—Ä—É
            if (data.user_role === 'owner') {
                document.getElementById('own-controls').style.display = 'block';
            }

            document.getElementById('loading').style.display = 'none';
        } catch (e) {
            alert("–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º");
        }
    }

    async function addShards() {
        const tid = prompt("–í–≤–µ–¥–∏—Ç–µ Telegram ID:");
        const amt = prompt("–°–∫–æ–ª—å–∫–æ –æ—Å–∫–æ–ª–∫–æ–≤ –ø—Ä–∏–±–∞–≤–∏—Ç—å?");
        if (!tid || !amt) return;

        const res = await fetch('/api/give', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ target_id: tid, amount: amt })
        });
        const d = await res.json();
        if (d.success) {
            alert("–ù–∞—á–∏—Å–ª–µ–Ω–æ!");
            location.reload(); // –ü–µ—Ä–µ–≥—Ä—É–∑–∏–º —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å
        }
    }

    init();
</script>
</body>
</html>
