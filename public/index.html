<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Anime AI 18+</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –°—Ç–∏–ª–∏–∑—É–µ–º –≤—Å—ë –ø–æ–¥ —Ç–≤–æ–π —Å–∫—Ä–∏–Ω—à–æ—Ç */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { 
            background: #000 !important; 
            margin: 0; padding: 0; 
            width: 100%; height: 100%; 
            overflow: hidden; 
            color: #fff; 
            font-family: sans-serif; 
        }

        /* –¢–í–û–Ø –õ–£–ù–ê - –ü–û–Ø–í–ò–¢–°–Ø –°–†–ê–ó–£ */
        #splash {
            position: fixed; inset: 0;
            background: #000;
            display: flex; justify-content: center; align-items: center;
            z-index: 10000;
        }
        .moon-loader {
            width: 100px; height: 100px;
            background: radial-gradient(circle at 30% 30%, #fff, #8a2be2 70%);
            border-radius: 50%;
            box-shadow: 0 0 50px #8a2be2;
            animation: moonPulse 2s infinite ease-in-out;
        }
        @keyframes moonPulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; box-shadow: 0 0 80px #8a2be2; }
        }

        /* –ì–õ–ê–í–ù–´–ô –≠–ö–†–ê–ù */
        #app { display: none; flex-direction: column; height: 100vh; padding: 10px; }
        
        .header { display: flex; justify-content: space-between; padding: 15px 10px; align-items: center; }
        .owner-name { color: #b026ff; font-weight: bold; font-size: 18px; }
        .shards-count { display: flex; align-items: center; font-size: 18px; font-weight: bold; }

        .grid-menu {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: repeat(5, 1fr);
            gap: 15px;
            flex-grow: 1;
            padding: 10px 5px;
        }

        .item-btn {
            background: rgba(35, 10, 50, 0.8);
            border: 1px solid rgba(138, 43, 226, 0.4);
            border-radius: 20px;
            display: flex; justify-content: center; align-items: center;
            font-weight: bold; font-size: 13px;
            text-transform: uppercase;
            cursor: pointer;
            transition: 0.2s;
        }
        .item-btn:active { transform: scale(0.95); background: rgba(138, 43, 226, 0.3); }
        .console-red { border: 1px solid #f00; color: #f00; }

        .footer {
            display: flex; justify-content: space-around;
            padding: 20px 10px;
            border-top: 1px solid #222;
        }
        .foot-item { font-size: 14px; opacity: 0.8; font-weight: bold; }
    </style>
</head>
<body>

<div id="splash"><div class="moon-loader"></div></div>

<div id="app">
    <div class="header">
        <div class="owner-name" id="userName">–ó–ê–ì–†–£–ó–ö–ê...</div>
        <div class="shards-count">üåô <span id="userShards">0</span></div>
    </div>

    <div class="grid-menu">
        <div class="item-btn">–ß–∞—Ç—ã</div>
        <div class="item-btn">–ü–µ—Ä—Å–æ–Ω–∞–∂–∏</div>
        <div class="item-btn">–ï–∂–µ–¥–Ω–µ–≤–∫–∞</div>
        <div class="item-btn">–ó–∞–¥–∞–Ω–∏—è</div>
        <div class="item-btn">–ú–∞–≥–∞–∑–∏–Ω</div>
        <div class="item-btn">–ü—Ä–æ–º–æ–∫–æ–¥—ã</div>
        <div class="item-btn">–ü—Ä–æ—Ñ–∏–ª—å</div>
        <div class="item-btn">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
        <div class="item-btn">–ê–¥–º–∏–Ω–∫–∞</div>
        <div class="item-btn console-red" id="consoleBtn">–ö–æ–Ω—Å–æ–ª—å</div>
    </div>

    <div class="footer">
        <div class="foot-item">‚óÄ –ù–ê–ó–ê–î</div>
        <div class="foot-item">üè† –î–û–ú–û–ô</div>
    </div>
</div>

<script>
    // 1. –°–†–ê–ó–£ –ì–û–í–û–†–ò–ú –¢–ï–õ–ï–ì–†–ê–ú–£, –ß–¢–û –ú–´ –¢–£–¢
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();
    tg.headerColor = '#000000';
    tg.backgroundColor = '#000000';

    const OWNER_ID = "8287041036";

    async function start() {
        // –ë–µ—Ä–µ–º ID —é–∑–µ—Ä–∞
        const myId = tg.initDataUnsafe?.user?.id?.toString() || new URLSearchParams(window.location.search).get('tgId') || "guest";

        try {
            // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ, –Ω–æ –Ω–µ –∂–¥–µ–º –≤–µ—á–Ω–æ
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 3000);

            const response = await fetch('/api/get-user?tgId=' + myId, { signal: controller.signal });
            const data = await response.json();
            
            updateUI(myId, data.user);
        } catch (e) {
            console.log("–ó–∞–≥—Ä—É–∑–∫–∞ –±–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞...");
            updateUI(myId, null);
        }

        // –ü—Ä—è—á–µ–º –ª—É–Ω—É
        setTimeout(() => {
            document.getElementById('splash').style.display = 'none';
            document.getElementById('app').style.display = 'flex';
        }, 1000);
    }

    function updateUI(id, user) {
        const nameEl = document.getElementById('userName');
        const shardsEl = document.getElementById('userShards');
        const conBtn = document.getElementById('consoleBtn');

        if (id === OWNER_ID) {
            nameEl.innerText = "–ê–∑—É–º–∏ –ê–π (BOSS)";
            shardsEl.innerText = "99999999";
        } else if (user) {
            nameEl.innerText = user.name.toUpperCase();
            shardsEl.innerText = user.shards;
            conBtn.style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –Ω–µ-–æ–≤–Ω–µ—Ä–æ–≤
        } else {
            nameEl.innerText = "GUEST";
            conBtn.style.display = 'none';
        }
    }

    // –ó–∞–ø—É—Å–∫
    start();

    // –§–∏–∫—Å —Å–≤–∞–π–ø–∞
    window.addEventListener('touchstart', (e) => {
        if (e.pageY < 10) e.preventDefault();
    }, { passive: false });
</script>

</body>
</html>
