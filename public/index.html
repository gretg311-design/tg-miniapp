<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Moon Console Pro</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --gold: #ffcc00; --bg: #0d0d0d; --card: #1a1a1a; }
        body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        
        /* –ì–ª–∞–≤–Ω–∞—è —Å–µ—Ç–∫–∞ –∫–æ–Ω—Å–æ–ª–∏ */
        .console-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            width: 100%;
            max-width: 500px;
            margin-top: 20px;
        }

        .console-item {
            background: var(--card);
            border: 1px solid #333;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: 0.3s;
        }
        .console-item:active { transform: scale(0.95); border-color: var(--gold); }
        .console-item i { display: block; font-size: 24px; margin-bottom: 8px; }

        /* –û–∫–Ω–∞ –º–æ–¥—É–ª–µ–π */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            overflow-y: auto;
            padding: 20px;
            box-sizing: border-box;
        }
        .modal-content {
            background: var(--card);
            border-radius: 20px;
            padding: 25px;
            max-width: 450px;
            margin: 40px auto;
            border: 1px solid var(--gold);
        }

        input, select, textarea {
            width: 100%; padding: 12px; margin: 10px 0;
            background: #2a2a2a; border: 1px solid #444;
            color: white; border-radius: 10px; box-sizing: border-box;
        }

        .btn-group { display: flex; gap: 10px; margin-top: 15px; }
        button { 
            flex: 1; padding: 12px; border-radius: 10px; border: none; 
            font-weight: bold; cursor: pointer; 
        }
        .btn-apply { background: var(--gold); color: black; }
        .btn-cancel { background: #444; color: white; }
        .btn-sub { background: #333; color: var(--gold); border: 1px solid var(--gold); font-size: 12px; }

        .hidden { display: none; }
    </style>
</head>
<body>

    <h2>üåô Moon App</h2>
    <div id="user-stats">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

    <button id="main-admin-btn" class="hidden" onclick="openMainConsole()" style="margin-top:20px; background: var(--gold); padding: 15px 30px; border-radius: 15px; border:none; font-weight:bold;">üõ† –û–¢–ö–†–´–¢–¨ –ö–û–ù–°–û–õ–¨</button>

    <div id="main-console" class="modal">
        <div class="modal-content">
            <h2 style="color:var(--gold); margin-top:0;">–ö–æ–Ω—Å–æ–ª—å –û–≤–Ω–µ—Ä–∞</h2>
            <div class="console-grid">
                <div class="console-item" onclick="openModule('mod-shards')">üåô –û—Å–∫–æ–ª–∫–∏</div>
                <div class="console-item" onclick="openModule('mod-subs')">‚ú® –ü–æ–¥–ø–∏—Å–∫–∞</div>
                <div class="console-item" onclick="openModule('mod-tasks')">üìã –ó–∞–¥–∞–Ω–∏—è</div>
                <div class="console-item" onclick="openModule('mod-promos')">üéü –ü—Ä–æ–º–æ–∫–æ–¥—ã</div>
                <div class="console-item" onclick="openModule('mod-char')">üë§ –ü–µ—Ä—Å–æ–Ω–∞–∂</div>
                <div class="console-item" onclick="openModule('mod-prices')">üí∞ –¶–µ–Ω—ã</div>
            </div>
            <button onclick="closeMainConsole()" class="btn-cancel" style="width:100%; margin-top:20px;">–í—ã–π—Ç–∏</button>
        </div>
    </div>

    <div id="mod-shards" class="modal">
        <div class="modal-content">
            <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ üåô</h3>
            <input type="number" id="shard-target-id" placeholder="Telegram ID">
            <input type="number" id="shard-amount" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ">
            <div class="btn-group">
                <button class="btn-apply" onclick="adminAction('give-shards')">–í—ã–¥–∞—Ç—å</button>
                <button style="background: #dc3545; color:white;" onclick="adminAction('take-shards')">–û—Ç–æ–±—Ä–∞—Ç—å</button>
            </div>
            <button onclick="closeModule('mod-shards')" class="btn-cancel" style="width:100%; margin-top:10px;">–ù–∞–∑–∞–¥</button>
        </div>
    </div>

    <div id="mod-subs" class="modal">
        <div class="modal-content">
            <h3>–í—ã–¥–∞—á–∞ –ø–æ–¥–ø–∏—Å–∫–∏</h3>
            <input type="number" id="sub-target-id" placeholder="Telegram ID">
            <div class="btn-group">
                <button class="btn-sub" onclick="setSub('Premium')">Premium</button>
                <button class="btn-sub" onclick="setSub('Pro')">Pro</button>
                <button class="btn-sub" onclick="setSub('VIP')">VIP</button>
                <button class="btn-sub" onclick="setSub('Ultra')">Ultra</button>
            </div>
            <select id="sub-duration">
                <option value="7">1 –Ω–µ–¥–µ–ª—è</option>
                <option value="30">1 –º–µ—Å—è—Ü</option>
                <option value="90">3 –º–µ—Å—è—Ü–∞</option>
                <option value="365">12 –º–µ—Å—è—Ü–µ–≤</option>
            </select>
            <button class="btn-apply" style="width:100%;" onclick="adminAction('give-sub')">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
            <button onclick="closeModule('mod-subs')" class="btn-cancel" style="width:100%; margin-top:10px;">–ù–∞–∑–∞–¥</button>
        </div>
    </div>

    <div id="mod-tasks" class="modal">
        <div class="modal-content">
            <h3>–ó–∞–¥–∞–Ω–∏—è</h3>
            <input type="text" id="task-title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä. –ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ –∫–∞–Ω–∞–ª)">
            <input type="text" id="task-link" placeholder="–°—Å—ã–ª–∫–∞ (https://t.me/...)">
            <select id="task-type">
                <option value="channel">–í—Å—Ç—É–ø–∏—Ç—å –≤ –∫–∞–Ω–∞–ª</option>
                <option value="bot">–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞</option>
                <option value="chat">–í—Å—Ç—É–ø–∏—Ç—å –≤ —á–∞—Ç</option>
            </select>
            <input type="number" id="task-reward" placeholder="–ù–∞–≥—Ä–∞–¥–∞ üåô">
            <button class="btn-apply" style="width:100%;" onclick="adminAction('add-task')">–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ</button>
            <div id="tasks-list" style="margin-top:15px; border-top:1px solid #333; padding-top:10px;">
                </div>
            <button onclick="closeModule('mod-tasks')" class="btn-cancel" style="width:100%; margin-top:10px;">–ù–∞–∑–∞–¥</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        let currentUser = null;
        let selectedSub = "";

        async function init() {
            const user = tg.initDataUnsafe?.user || { id: 8287041036, first_name: "Owner" };
            const res = await fetch('/api/auth', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ tg_id: user.id, name: user.first_name })
            });
            currentUser = await res.json();
            
            document.getElementById('user-stats').innerHTML = `–ü—Ä–∏–≤–µ—Ç, ${currentUser.name}! üåô: ${currentUser.moon_shards}`;
            
            if (currentUser.role === 'owner' || currentUser.role === 'admin') {
                document.getElementById('main-admin-btn').classList.remove('hidden');
            }
        }

        function openMainConsole() { document.getElementById('main-console').style.display = 'block'; }
        function closeMainConsole() { document.getElementById('main-console').style.display = 'none'; }
        
        function openModule(id) { document.getElementById(id).style.display = 'block'; }
        function closeModule(id) { document.getElementById(id).style.display = 'none'; }

        function setSub(type) { 
            selectedSub = type; 
            alert("–í—ã–±—Ä–∞–Ω–æ: " + type);
        }

        async function adminAction(type) {
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç fetch –∫ —Ç–≤–æ–µ–º—É API (give, take, add-task –∏ —Ç.–¥.)
            alert("–î–µ–π—Å—Ç–≤–∏–µ " + type + " –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä!");
        }

        init();
    </script>
</body>
</html>
