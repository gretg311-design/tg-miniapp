<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --neon: #bc13fe; --glass: rgba(15, 5, 25, 0.98); --border: rgba(188, 19, 254, 0.5); }
        body { background: #000; color: #fff; font-family: sans-serif; margin: 0; overflow: hidden; height: 100vh; touch-action: none; }
        .screen { display: none; height: calc(100vh - 70px); flex-direction: column; overflow-y: auto; padding: 15px; }
        .active { display: flex; }
        .glass { background: var(--glass); border: 1px solid var(--border); border-radius: 15px; padding: 15px; margin-bottom: 15px; }
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .menu-btn { height: 85px; display: flex; align-items: center; justify-content: center; text-align: center; font-size: 11px; font-weight: bold; border: 1px solid var(--border); border-radius: 15px; text-transform: uppercase; cursor: pointer; background: rgba(188, 19, 254, 0.05); }
        .menu-btn:active { background: var(--neon); transform: scale(0.95); }
        .bottom-nav { position: fixed; bottom: 0; width: 100%; height: 70px; background: var(--glass); border-top: 1px solid var(--neon); display: flex; justify-content: space-around; align-items: center; }
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; background: #0c0212; border: 1px solid var(--neon); color: #fff; border-radius: 10px; }
        .btn-main { width: 100%; padding: 15px; background: var(--neon); border: none; color: #fff; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-red { background: #ff1f44; }
        .char-card { display: flex; gap: 15px; align-items: center; cursor: pointer; }
        .char-img { width: 70px; height: 70px; border-radius: 12px; object-fit: cover; border: 1px solid var(--neon); }
        .chat-msg { background: rgba(188, 19, 254, 0.1); padding: 10px; border-radius: 10px; margin-bottom: 10px; max-width: 80%; }
    </style>
</head>
<body>

<div id="scr-main" class="screen active">
    <div class="glass" style="display:flex; justify-content:space-between; align-items:center;">
        <div><b id="u-name" style="color:var(--neon)">German Green (BOSS)</b><br><small id="u-id" style="color:#888"></small></div>
        <div>üåô <b id="u-bal">0</b></div>
    </div>
    <div class="menu-grid">
        <div class="menu-btn" onclick="openMod('chats')">–ß–∞—Ç—ã</div>
        <div class="menu-btn" onclick="openMod('chars')">–ü–µ—Ä—Å–æ–Ω–∞–∂–∏</div>
        <div class="menu-btn" onclick="openMod('daily')">–ï–∂–µ–¥–Ω–µ–≤–∫–∞</div>
        <div class="menu-btn" onclick="openMod('tasks')">–ó–∞–¥–∞–Ω–∏—è</div>
        <div class="menu-btn" onclick="openMod('shop')">–ú–∞–≥–∞–∑–∏–Ω</div>
        <div class="menu-btn" onclick="openMod('promo')">–ü—Ä–æ–º–æ–∫–æ–¥</div>
        <div class="menu-btn" onclick="openMod('profile')">–ü—Ä–æ—Ñ–∏–ª—å</div>
        <div class="menu-btn" onclick="openMod('settings')">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
        <div id="adm-btn" class="menu-btn" style="display:none" onclick="openMod('admin')">–ê–¥–º–∏–Ω–∫–∞</div>
        <div id="cons-btn" class="menu-btn" style="display:none; color:#ff1f44; border-color:#ff1f44;" onclick="openMod('console')">–ö–æ–Ω—Å–æ–ª—å</div>
    </div>
</div>

<div id="scr-mod" class="screen"><div id="mod-content"></div></div>

<nav class="bottom-nav">
    <div onclick="goHome()">üè† –î–æ–º–æ–π</div>
    <div onclick="goBack()">‚óÄ –ù–∞–∑–∞–¥</div>
</nav>

<script>
    const tg = window.Telegram.WebApp;
    const OWNER_ID = "8287041036";
    tg.expand();
    tg.enableClosingConfirmation();

    let user = { id: "", name: "", balance: 100, role: "user", gender: "–ú", streak: 7 };
    let bots = []; 
    let activeChats = [];
    let tempPhoto = "";

    function init() {
        const d = tg.initDataUnsafe.user || { id: OWNER_ID, first_name: "German" };
        user.id = String(d.id);
        user.name = d.first_name;
        if(user.id === OWNER_ID) { user.role = "owner"; user.balance = 99999999; }
        updateUI();
    }

    function updateUI() {
        document.getElementById('u-name').innerText = user.name + (user.role === 'owner' ? " (BOSS)" : "");
        document.getElementById('u-id').innerText = "ID: " + user.id;
        document.getElementById('u-bal').innerText = user.balance.toLocaleString();
        if(user.role === 'owner' || user.role === 'admin') document.getElementById('adm-btn').style.display = 'flex';
        if(user.role === 'owner') document.getElementById('cons-btn').style.display = 'flex';
    }

    function openMod(type, data = null) {
        const cont = document.getElementById('mod-content');
        document.getElementById('scr-main').classList.remove('active');
        document.getElementById('scr-mod').classList.add('active');
        
        let html = `<div class="glass"><h2>${type.toUpperCase()}</h2>`;

        if(type === 'chars') {
            if(bots.length === 0) html += `<p>–ü—É—Å—Ç–æ. –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ –≤ –ö–æ–Ω—Å–æ–ª–∏!</p>`;
            bots.forEach((b, i) => {
                html += `<div class="glass char-card" onclick="startChat(${i})">
                    <img src="${b.photo || 'https://via.placeholder.com/70'}" class="char-img">
                    <div><b>${b.name}, ${b.age}–≥.</b><br><small>${b.desc.substring(0,40)}...</small></div>
                </div>`;
            });
        } 
        else if(type === 'chats') {
            if(activeChats.length === 0) html += `<p>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —á–∞—Ç–æ–≤.</p>`;
            activeChats.forEach((c, i) => {
                html += `<div class="glass char-card">
                    <img src="${c.photo}" class="char-img" onclick="openChatView(${i})">
                    <div style="flex:1" onclick="openChatView(${i})"><b>${c.name}</b><br><small>–ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...</small></div>
                    <button class="btn-main" style="width:auto; margin:0;" onclick="showChatMenu(${i})">‚ãÆ</button>
                </div>`;
            });
        }
        else if(type === 'console' || type === 'admin') {
            const isO = (user.role === 'owner' && type === 'console');
            html += `<b>–°–û–ó–î–ê–¢–¨ –ü–ï–†–°–û–ù–ê–ñ–ê</b>
                <input id="bn" placeholder="–ò–º—è"><textarea id="bd" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ/–•–∞—Ä–∞–∫—Ç–µ—Ä"></textarea>
                <input type="file" accept="image/*" onchange="handlePhoto(this)">
                <button class="btn-main" onclick="saveBot()">–°–û–ó–î–ê–¢–¨</button>
                <hr style="margin:20px 0; border:1px solid #333">
                <b>–†–ï–°–£–†–°–´ (ID)</b><input id="tid" placeholder="ID —é–∑–µ—Ä–∞"><input id="tval" placeholder="–°—É–º–º–∞/–î–Ω–∏">
                <button class="btn-main" onclick="tg.showAlert('–í—ã–ø–æ–ª–Ω–µ–Ω–æ!')">–í–´–î–ê–¢–¨</button>
                ${isO ? `<button class="btn-main btn-red" onclick="tg.showAlert('–°–Ω—è—Ç–æ!')">–°–ù–Ø–¢–¨</button><hr>
                <b>–ê–î–ú–ò–ù–´</b><input placeholder="ID"><button class="btn-main">–ù–ê–ó–ù–ê–ß–ò–¢–¨</button><button class="btn-main btn-red">–°–ù–Ø–¢–¨</button>` : ''}`;
        }
        else if(type === 'settings') {
            html += `–ò–º—è:<input id="sn" value="${user.name}">–ü–æ–ª:<select id="sg"><option value="–ú">–ú</option><option value="–ñ">–ñ</option></select><button class="btn-main" onclick="user.name=document.getElementById('sn').value; updateUI(); goHome();">–°–û–•–†–ê–ù–ò–¢–¨</button>`;
        }
        else { html += `<p>–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∞–∫—Ç–∏–≤–µ–Ω.</p>`; }
        
        cont.innerHTML = html + `</div>`;
    }

    function handlePhoto(input) {
        const reader = new FileReader();
        reader.onload = (e) => { tempPhoto = e.target.result; };
        reader.readAsDataURL(input.files[0]);
    }

    function saveBot() {
        const name = document.getElementById('bn').value;
        const desc = document.getElementById('bd').value;
        if(!name) return;
        bots.push({ name, desc, age: 18, photo: tempPhoto });
        tg.showAlert("–ë–æ—Ç —Å–æ–∑–¥–∞–Ω!");
        tempPhoto = ""; goHome();
    }

    function startChat(i) {
        const bot = bots[i];
        if(!activeChats.find(c => c.name === bot.name)) activeChats.push(bot);
        openChatView(activeChats.length - 1);
    }

    function openChatView(i) {
        const bot = activeChats[i];
        const cont = document.getElementById('mod-content');
        cont.innerHTML = `<div class="glass" style="height:70vh; display:flex; flex-direction:column;">
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid var(--neon); padding-bottom:10px;">
                <b>–ß–∞—Ç —Å ${bot.name}</b><button class="btn-main" style="width:auto; margin:0;" onclick="showChatMenu(${i})">‚ãÆ</button>
            </div>
            <div style="flex:1; padding:10px; overflow-y:auto;">
                <div class="chat-msg">–ü—Ä–∏–≤–µ—Ç! –Ø ${bot.name}. –ö–∞–∫ –¥–µ–ª–∞?</div>
            </div>
            <div style="display:flex; gap:10px;">
                <input placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
                <button class="btn-main" style="width:80px; margin:0;">‚û°</button>
            </div>
        </div>`;
    }

    function showChatMenu(i) {
        tg.showActionSheet({
            title: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–æ–º',
            buttons: [
                {text: '–ó–∞–∫—Ä–µ–ø–∏—Ç—å', id: 'pin'},
                {text: '–°—Ç–µ—Ä–µ—Ç—å –ø–∞–º—è—Ç—å', id: 'clear'},
                {text: '–£–¥–∞–ª–∏—Ç—å —á–∞—Ç', id: 'del', type: 'destructive'}
            ]
        }, (id) => {
            if(id === 'del') { activeChats.splice(i, 1); openMod('chats'); }
            else if(id === 'clear') tg.showAlert("–ü–∞–º—è—Ç—å –±–æ—Ç–∞ —Å—Ç–µ—Ä—Ç–∞!");
        });
    }

    function goHome() { document.getElementById('scr-mod').classList.remove('active'); document.getElementById('scr-main').classList.add('active'); }
    function goBack() { goHome(); }
    init();
</script>
</body>
</html>
