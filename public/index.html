<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { background: #060a16; color: white; font-family: sans-serif; padding: 15px; margin: 0; }
        .header { display: flex; justify-content: space-between; color: #60a5fa; margin-bottom: 20px; font-weight: bold; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn { background: #151c30; border: 1px solid #232d4b; padding: 22px 5px; border-radius: 12px; text-align: center; font-weight: bold; font-size: 11px; letter-spacing: 1px; }
        .full { grid-column: span 2; background: #3b82f6; border: none; padding: 16px; border-radius: 12px; color: white; margin-top: 10px; font-weight: bold; width: 100%; }
        .screen { display: none; } .active { display: block; }
        .card { background: #1e2944; padding: 12px; border-radius: 12px; margin-bottom: 12px; border: 1px solid #3b82f6; }
        input, textarea { width: 100%; margin: 8px 0; background: #0b1121; border: 1px solid #3b82f6; color: white; padding: 12px; box-sizing: border-box; border-radius: 8px; }
    </style>
</head>
<body>

    <div id="main-screen" class="screen active">
        <div class="header">
            <span id="userName">...</span>
            <span>ğŸŒ™ <span id="userBal">100</span></span>
        </div>
        <div class="grid">
            <div class="btn" onclick="tg.showAlert('Ğ§Ğ°Ñ‚Ñ‹ Ğ² Telegram')">ğŸ’¬ Ğ§ĞĞ¢Ğ«</div>
            <div class="btn" onclick="showScreen('chars-screen', loadChars)">ğŸ§ ĞŸĞ•Ğ Ğ¡ĞĞĞĞ–Ğ˜</div>
            <div class="btn" onclick="tg.showAlert('Ğ‘Ğ¾Ğ½ÑƒÑ: +5 ğŸŒ™')">ğŸ Ğ•Ğ–Ğ•Ğ”ĞĞ•Ğ’ĞšĞ</div>
            <div class="btn" onclick="showScreen('tasks-screen', loadTasks)">ğŸ“‹ Ğ—ĞĞ”ĞĞĞ˜Ğ¯</div>
            <div class="btn" onclick="tg.showAlert('ĞœĞ°Ğ³Ğ°Ğ·Ğ¸Ğ½ 18+')">ğŸ›’ ĞœĞĞ“ĞĞ—Ğ˜Ğ</div>
            <div class="btn" onclick="tg.showAlert('ğŸŸ ĞšĞ¾Ğ´ Ğ¿Ñ€Ğ¸Ğ½ÑÑ‚')">ğŸŸ ĞŸĞ ĞĞœĞĞšĞĞ”Ğ«</div>
            <div class="btn" onclick="tg.showAlert('ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ ĞĞ²Ğ½ĞµÑ€Ğ°')">ğŸ‘¤ ĞŸĞ ĞĞ¤Ğ˜Ğ›Ğ¬</div>
            <div class="btn" onclick="tg.showAlert('ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹')">âš™ï¸ ĞĞĞ¡Ğ¢Ğ ĞĞ™ĞšĞ˜</div>
            <button class="full" onclick="window.open('https://t.me/news')">ğŸ“¢ ĞĞĞ’ĞĞ¡Ğ¢Ğ˜</button>
            <button class="full" style="background:#ef4444; display:none;" id="godBtn" onclick="showScreen('admin-screen')">ğŸ’» ĞšĞĞĞ¡ĞĞ›Ğ¬ Ğ‘ĞĞ“Ğ</button>
        </div>
    </div>

    <div id="chars-screen" class="screen">
        <h3>ğŸ§ Ğ¢Ğ²Ğ¾Ğ¸ ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ¸</h3>
        <div id="chars-list">Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...</div>
        <button class="full" style="background:#444" onclick="showScreen('main-screen')">ĞĞ°Ğ·Ğ°Ğ´</button>
    </div>

    <div id="tasks-screen" class="screen">
        <h3>ğŸ“‹ Ğ—Ğ°Ğ´Ğ°Ğ½Ğ¸Ñ</h3>
        <div id="tasks-list">Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¿ÑƒÑÑ‚</div>
        <button class="full" style="background:#444" onclick="showScreen('main-screen')">ĞĞ°Ğ·Ğ°Ğ´</button>
    </div>

    <div id="admin-screen" class="screen">
        <h3 style="color:#ef4444">Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ (ĞĞ²Ğ½ĞµÑ€)</h3>
        <input type="text" id="cName" placeholder="Ğ˜Ğ¼Ñ Ğ°Ğ½Ğ¸Ğ¼Ğµ-Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ°">
        <textarea id="cBio" placeholder="Ğ¥Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: ĞŸĞ¾ÑˆĞ»Ğ°Ñ ÑĞµÑÑ‚Ñ€Ğ°)"></textarea>
        <input type="file" id="cFile">
        <button class="full" style="background:#22c55e" onclick="saveChar()">âœ… Ğ¡ĞĞ—Ğ”ĞĞ¢Ğ¬ & Ğ—ĞĞ“Ğ Ğ£Ğ—Ğ˜Ğ¢Ğ¬</button>
        <hr>
        <input type="text" id="tTitle" placeholder="Ğ¢ĞµĞºÑÑ‚ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ñ">
        <input type="text" id="tLink" placeholder="Ğ¡ÑÑ‹Ğ»ĞºĞ° (t.me/...)">
        <button class="full" style="background:#3b82f6" onclick="saveTask()">â• Ğ”ĞĞ‘ĞĞ’Ğ˜Ğ¢Ğ¬ Ğ—ĞĞ”ĞĞĞ˜Ğ•</button>
        <button class="full" style="background:#444" onclick="showScreen('main-screen')">Ğ—ĞĞšĞ Ğ«Ğ¢Ğ¬</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        document.getElementById('userName').innerText = tg.initDataUnsafe.user?.first_name || "Owner";
        if(tg.initDataUnsafe.user?.id === 8287041036) document.getElementById('godBtn').style.display = 'block';

        function showScreen(id, callback) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(callback) callback();
        }

        async function saveChar() {
            const formData = new FormData();
            formData.append('name', document.getElementById('cName').value);
            formData.append('bio', document.getElementById('cBio').value);
            formData.append('photo', document.getElementById('cFile').files[0]);
            await fetch('/api/chars', { method: 'POST', body: formData });
            tg.showAlert("ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶ ÑĞ¾Ğ·Ğ´Ğ°Ğ½! Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ¾Ğ½ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¸Ñ‚ Ñ‚ĞµĞ±Ğµ Ğ² Ñ‡Ğ°Ñ‚Ğµ.");
            showScreen('main-screen');
        }

        async function saveTask() {
            await fetch('/api/tasks', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    action: 'add',
                    title: document.getElementById('tTitle').value,
                    link: document.getElementById('tLink').value
                })
            });
            tg.showAlert("Ğ—Ğ°Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾!");
            showScreen('main-screen');
        }

        async function loadChars() {
            const res = await fetch('/api/chars');
            const data = await res.json();
            document.getElementById('chars-list').innerHTML = data.map(c => `
                <div class="card">
                    <img src="${c.photo}" style="width:100%; border-radius:10px; margin-bottom:10px;">
                    <b>${c.name}</b><br><small>${c.bio}</small>
                </div>
            `).join('');
        }

        async function loadTasks() {
            const res = await fetch('/api/tasks');
            const data = await res.json();
            document.getElementById('tasks-list').innerHTML = data.map(t => `
                <div class="card" onclick="window.open('${t.link}')">
                    <b>${t.title}</b><br>ĞĞ°Ğ³Ñ€Ğ°Ğ´Ğ°: 10 ğŸŒ™
                </div>
            `).join('');
        }
    </script>
</body>
</html>
